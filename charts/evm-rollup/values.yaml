global:
  namespaceOverride: ""
  replicaCount: 1
  # Whether to use tty readable logging for astria services, when false use json.
  # Best to be false in production environments, true for clean logs on local dev.
  useTTY: false
  dev: false

images:
  geth:
    repo: ghcr.io/astriaorg/astria-geth
    pullPolicy: IfNotPresent
    tag: 1.0.0
    devTag: sha-179a7c7
    overrideTag: ""
  conductor:
    repo: ghcr.io/astriaorg/conductor
    pullPolicy: IfNotPresent
    tag: 1.0.0
    devTag: pr-1866


genesis:
  ## These values are used to configure the genesis block of the rollup chain
  ## no defaults as they are unique to each chain

  # The name of the rollup chain, used to generate the Rollup ID
  rollupName: ""
  # Block height to start syncing rollup from, lowest possible is 2
  sequencerInitialHeight: ""
  # The first Celestia height to utilize when looking for rollup data
  celestiaInitialHeight: ""
  # The variance in Celestia height to allow before halting the chain
  celestiaHeightVariance: ""
  # Will fill the extra data in each block, can be left empty
  # can also fill with something unique for your chain.
  extraDataOverride: ""

  ## These are general configuration values with some recommended defaults

  # Configure the gas Limit
  gasLimit: "50000000"
  # If set to true the genesis block will contain extra data
  overrideGenesisExtraData: true
  # The hrp for bech32m addresses, unlikely to be changed
  sequencerAddressPrefix: "astria"

  ## These values are used to configure astria native bridging
  ## Many of the fields have commented out example fields

  # Configure the sequencer bridge addresses and allowed assets if using
  # the astria canonical bridge. Recommend removing alloc values if so.
  bridgeAddresses: []
    # - address: "684ae50c49a434199199c9c698115391152d7b3f"
    #   startHeight: 1
    #   assetDenom: "nria"
    #   senderAddress: "0x0000000000000000000000000000000000000000"
    #   assetPrecision: 9

  ## Native oracle configuration

  # address from which injected oracle transactions are called from;
  # must not have a known private key for mainnet
  astriaOracleCallerAddress: "0x0000000000000000000000000000000000000088"
  # address where the oracle contract is deployed at (at genesis)
  # must match the `alloc` genesis field
  astriaOracleContractAddress: "0x0000000000000000000000000000000000000089"

  ## Fee configuration

  # Configure the fee collector for the evm tx fees, activated at block heights.
  # If not configured, all tx fees will be burned.
  feeCollectors: {}
  # 1: "0xaC21B97d35Bf75A7dAb16f35b111a50e78A72F30"
  # Configure EIP-1559 params, activated at block heights
  eip1559Params: {}
    # 1:
    #   minBaseFee: 0
    #   elasticityMultiplier: 2
    #   baseFeeChangeDenominator: 8

  ## Standard Eth Genesis config values
  # An EVM chain number id, different from the astria rollup name
  chainId: ""
  # Configuration of Eth forks, setting to 0 will enable from height,
  # left as is these forks will not activate.
  cancunTime: ""
  pragueTime: ""
  verkleTime: ""
  # Can configure the genesis allocs for the chain
  alloc:
    # Deploying the deterministic deploy proxy contract in genesis
    # Forge and other tools use this for their CREATE2 usage, but
    # can only be included through the genesis block after EIP-155
    # https://github.com/Arachnid/deterministic-deployment-proxy
    - address: "0x4e59b44847b379578588920cA78FbF26c0B4956C"
      value:
        balance: "0"
        code: "0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe03601600081602082378035828234f58015156039578182fd5b8082525050506014600cf3"
    - address: "0x0000000000000000000000000000000000000089"  ## oracle contract
      value:
        balance: "0"
        code: "0x608060405234801561001057600080fd5b50600436106100ea5760003560e01c80638da5cb5b1161008c578063abcdd06911610066578063abcdd0691461021a578063dad84e9d1461023d578063f2fde38b1461029a578063f6dad934146102ad57600080fd5b80638da5cb5b146101d257806395009a53146101e35780639c97f6d8146101f657600080fd5b806348832f3c116100c857806348832f3c1461015f578063715018a614610172578063859bd5b51461017a578063888810c9146101bf57600080fd5b806338013f02146100ef5780633a6a7162146101335780634599c78814610148575b600080fd5b6101167f000000000000000000000000000000000000000000000000000000000000008881565b6040516001600160a01b0390911681526020015b60405180910390f35b610146610141366004610865565b6102c0565b005b61015160045481565b60405190815260200161012a565b61014661016d366004610891565b6103da565b6101466104ea565b6101a66101883660046108c7565b60026020526000908152604090205460ff8082169161010090041682565b60408051921515835260ff90911660208301520161012a565b6101466101cd3660046108e0565b6104fe565b6000546001600160a01b0316610116565b6101466101f13660046109e6565b610524565b60005461020a90600160a01b900460ff1681565b604051901515815260200161012a565b61020a6102283660046108c7565b60016020526000908152604090205460ff1681565b61027b61024b366004610a9f565b6003602090815260009283526040808420909152908252902080546001909101546001600160801b039091169082565b604080516001600160801b03909316835260208301919091520161012a565b6101466102a8366004610ac1565b610768565b6101466102bb3660046108c7565b6107a6565b336001600160a01b037f000000000000000000000000000000000000000000000000000000000000008816146103115760405162461bcd60e51b815260040161030890610aea565b60405180910390fd5b4360045560008281526002602052604090205460ff166103475760405163183c4ba760e01b815260006004820152602401610308565b6040805180820182526001600160801b038381168083524260208085019182526004546000908152600382528681208982528252869020945185546001600160801b0319169416939093178455516001909301929092558251858152908101919091527fd616ae5f8d378c1264fdbbbc72af91e16e3645564d7eae37e267ef1c67bf5cee91015b60405180910390a15050565b336001600160a01b037f000000000000000000000000000000000000000000000000000000000000008816146104225760405162461bcd60e51b815260040161030890610aea565b600054600160a01b900460ff16801561044a575060008281526001602052604090205460ff16155b1561046b5760405163401e592360e01b815260048101839052602401610308565b6040805180820182526001815260ff838116602080840182815260008881526002835286902094518554915161ffff1990921690151561ff001916176101009190941602929092179092558251858152908101919091527f675b5c62c7826a107baf315a10339c41c59f32f58ac6431f359e9ac89c64a01b91016103ce565b6104f26107cc565b6104fc60006107f9565b565b6105066107cc565b60008054911515600160a01b0260ff60a01b19909216919091179055565b336001600160a01b037f0000000000000000000000000000000000000000000000000000000000000088161461056c5760405162461bcd60e51b815260040161030890610aea565b80518251146105cd5760405162461bcd60e51b815260206004820152602760248201527f63757272656e6379207061697220616e64207072696365206c656e677468206d6044820152660d2e6dac2e8c6d60cb1b6064820152608401610308565b4360045560005b825181101561076357600260008483815181106105f3576105f3610b2e565b60209081029190910181015182528101919091526040016000205460ff166106315760405163183c4ba760e01b815260048101829052602401610308565b604051806040016040528083838151811061064e5761064e610b2e565b60200260200101516001600160801b0316815260200142815250600360006004548152602001908152602001600020600085848151811061069157610691610b2e565b602090810291909101810151825281810192909252604001600020825181546001600160801b0319166001600160801b0390911617815591015160019091015582517fd616ae5f8d378c1264fdbbbc72af91e16e3645564d7eae37e267ef1c67bf5cee9084908390811061070757610707610b2e565b602002602001015183838151811061072157610721610b2e565b60200260200101516040516107499291909182526001600160801b0316602082015260400190565b60405180910390a18061075b81610b44565b9150506105d4565b505050565b6107706107cc565b6001600160a01b03811661079a57604051631e4fbdf760e01b815260006004820152602401610308565b6107a3816107f9565b50565b6107ae6107cc565b6000908152600160208190526040909120805460ff19169091179055565b6000546001600160a01b031633146104fc5760405163118cdaa760e01b8152336004820152602401610308565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b80356001600160801b038116811461086057600080fd5b919050565b6000806040838503121561087857600080fd5b8235915061088860208401610849565b90509250929050565b600080604083850312156108a457600080fd5b82359150602083013560ff811681146108bc57600080fd5b809150509250929050565b6000602082840312156108d957600080fd5b5035919050565b6000602082840312156108f257600080fd5b8135801515811461090257600080fd5b9392505050565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f1916810167ffffffffffffffff8111828210171561094857610948610909565b604052919050565b600067ffffffffffffffff82111561096a5761096a610909565b5060051b60200190565b600082601f83011261098557600080fd5b8135602061099a61099583610950565b61091f565b82815260059290921b840181019181810190868411156109b957600080fd5b8286015b848110156109db576109ce81610849565b83529183019183016109bd565b509695505050505050565b600080604083850312156109f957600080fd5b823567ffffffffffffffff80821115610a1157600080fd5b818501915085601f830112610a2557600080fd5b81356020610a3561099583610950565b82815260059290921b84018101918181019089841115610a5457600080fd5b948201945b83861015610a7257853582529482019490820190610a59565b96505086013592505080821115610a8857600080fd5b50610a9585828601610974565b9150509250929050565b60008060408385031215610ab257600080fd5b50508035926020909101359150565b600060208284031215610ad357600080fd5b81356001600160a01b038116811461090257600080fd5b60208082526024908201527f4173747269614f7261636c653a206f6e6c79206f7261636c652063616e2075706040820152636461746560e01b606082015260800190565b634e487b7160e01b600052603260045260246000fd5b600060018201610b6457634e487b7160e01b600052601160045260246000fd5b506001019056fea26469706673582212203dba20374b20748c9e2f92d4416b253adb31e624e5086145f955c848297d924c64736f6c63430008150033"
    # Example of simple genesis account funding
    # - address: "0xaC21B97d35Bf75A7dAb16f35b111a50e78A72F30"
    #   value:
    #   # The balance must be a string due to size
    #   balance: "1000000000000000000000000000"

config:
  # The level at which core astria components will log out
  # Options are: error, warn, info, and debug
  logLevel: "debug"

  geth:
    # Set to true to keep history of all blocks
    archiveNode: false
    # Set to true to clear the mempool on startup/restart
    purgeMempool: false
    flags:
      - name: datadir
        value: '{{ include "rollup.gethDataDir" . }}'
      - name: networkid
        value: "{{ tpl .Values.genesis.chainId . }}"
      - name: http
      - name: http.addr
        value: 0.0.0.0
      - name: http.port
        value: "{{ .Values.ports.jsonRPC }}"
      - name: http.corsdomain
        value: "*"
      - name: http.vhosts
        value: "*"
      - name: http.api
        value: eth,net,web3,debug,txpool
      - name: ws
      - name: ws.addr
        value: 0.0.0.0
      - name: ws.port
        value: "{{ .Values.ports.wsRPC }}"
      - name: ws.origins
        value: "*"
      - name: grpc
      - name: grpc.addr
        value: 0.0.0.0
      - name: grpc.port
        value: "{{ .Values.ports.executionGRPC }}"
      - name: db.engine
        value: pebble  # Can be set to 'pebble' or 'leveldb'
      - name: maxpeers
        value: "0"
      - name: rpc.gascap
        value: "{{ .Values.genesis.gasLimit }}"
      - name: rpc.txfeecap
        value: "0"
      - name: gcmode
        value: "{{- if .Values.config.geth.archiveNode -}} archive {{- else -}} full {{- end }}"
      - name: state.scheme
        value: "{{- if .Values.config.geth.archiveNode -}} hash {{- else -}} path {{- end }}"
      - name: history.transactions
        value: "{{- if .Values.config.geth.archiveNode -}} 0 {{- else -}} 2350000 {{- end }}"
      - name: history.state
        value: "{{- if .Values.config.geth.archiveNode -}} 0 {{- else -}} 540000 {{- end }}"
      - name: metrics
        condition: .Values.metrics.enabled
      - name: metrics.addr
        value: 0.0.0.0
        condition: .Values.metrics.enabled
      - name: metrics.port
        value: "{{ .Values.ports.metrics }}"
        condition: .Values.metrics.enabled
      - name: txpool.nolocals
        value: "true"
      - name: verbosity
        value: "4"  # 3=info, 4=debug

  conductor:
    # Determines what will drive block execution, options are:
    # - "SoftOnly" -> blocks are only pulled from the sequencer
    # - "FirmOnly" -> blocks are only pulled from DA
    # - "SoftAndFirm" -> blocks are pulled from both the sequencer and DA
    executionCommitLevel: 'SoftAndFirm'
    # The chain id of the Astria sequencer chain conductor communicates with
    sequencerChainId: ""
    # The expected fastest block time possible from sequencer, determines polling
    # rate.
    sequencerBlockTimeMs: 2000
    # The expected fastest block time possible from DA, determines polling rate.
    celestiaBlockTimeMs: 6000
    # URL path for the sequencer
    sequencerRpc: ""
    # gRPC path for the sequencer
    sequencerGrpc: ""
    # The maximum number of requests to make to the sequencer per second
    sequencerRequestsPerSecond: 500
    # The chain id of the celestia network the conductor communicates with
    celestiaChainId: ""

  celestia:
    # if config.rollup.executionLevel is NOT 'SoftOnly' AND celestia-node is not enabled
    # the rpc, ws, and token fields must be set to access celestia network.
    rpc: ""
    token: ""

metrics:
  # set to enable prometheus metrics
  enabled: false

otel:
  enabled: false
  serviceNamePrefix: '{{ include "rollup.name" . }}'
  endpoint: ""
  tracesEndpoint: ""
  tracesCompression: "gzip"
  tracesTimeout: "10"
  otlpHeaders: ""
  traceHeaders: ""

serviceMonitor:
  # set to enable port svc and service monitor
  enabled: false
  port: 6060
  additionalLabels:
    release: kube-prometheus-stack
alerting:
  enabled: false
  interval: ""
  additionalLabels:
    release: kube-prometheus-stack
  annotations: {}
  # scrapeTimeout: 10s
  # path: /metrics
  prometheusRule:
    enabled: true
    additionalLabels:
      release: kube-prometheus-stack
    namespace: monitoring
    rules:
    - alert: Geth_Slow_Finalized
      expr: increase(chain_head_finalized{namespace="astria-dusk3-cluster"}[5m]) < 20  # Insert your query Expression
      for: 5m  # Rough number but should be enough to init warn
      labels:
        severity: critical
      annotations:
        summary: Slow Chain Head Finalized (instance {{ $labels.instance }})
        description: "Chain Head Finalized on {{ $labels.namespace }} is increasing at a rate slower then 20 blocks per 5 minute\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

ingress:
  enabled: false
  labels: {}
  hostname: localdev.me
  className: nginx
  services:
    rpc:
      enabled: true
      hosts:
        - 'executor.{{ include "rollup.name" . }}.{{ .Values.ingress.hostname }}'
      path: /
      pathType: Prefix
      service:
        name: '{{ include "rollup.name" . }}-evm-service'
        port:
          name: json-rpc-svc
      annotations: {}
        # kubernetes.io/ingress.class: nginx
        # kubernetes.io/tls-acme: "true"
      labels: {}
      tls: {}
      #  - secretName: chart-example-tls
      #    hosts:
      #      - chart-example.local
    ws:
      enabled: true
      hosts:
        - ws-executor.{{ include "rollup.name" . }}.{{ .Values.ingress.hostname }}
      path: /
      pathType: Prefix
      service:
        name: '{{ include "rollup.name" . }}-evm-service'
        port:
          name: ws-rpc-svc
      annotations: {}
        # kubernetes.io/ingress.class: nginx
        # kubernetes.io/tls-acme: "true"
      labels: {}
      tls: {}
      #  - secretName: chart-example-tls
      #    hosts:
      #      - chart-example.local

# Default persistent storage values
# NOTE - `rollupName` will be used with `persistentVolumeName` to generate names for kubernetes resources.
#  e.g. astria-executor-pv, astria-executor-pvc
resources:
  conductor:
    requests:
      cpu: 100m
      memory: 200Mi
    limits:
      cpu: 1000m
      memory: 2Gi
  geth:
    requests:
      cpu: 16000m
      memory: 32Gi

storage:
  enabled: false
  local: true
  entities:
    rollupSharedStorage:
      size: "5Gi"
      persistentVolumeName: "rollup-shared-storage"
      path: "/data/rollup-data"

# Default service ports
ports:
  jsonRPC: 8545
  wsRPC: 8546
  executionGRPC: 50051
  metrics: 6060
  conductorMetrics: 9000
