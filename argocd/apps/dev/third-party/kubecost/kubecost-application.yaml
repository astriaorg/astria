apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kubecost
  namespace: argocd
spec:
  project: default
  destination: 
    server: https://kubernetes.default.svc
    namespace: kubecost
  sources:
    - repoURL: https://kubecost.github.io/cost-analyzer
      chart: cost-analyzer
      targetRevision: "2.2.4"
      helm:
        releaseName: kubecost
        valueFiles:
          - $values/argocd/apps/dev/third-party/kubecost/values.yaml


        valuesObject:

          kubecostMetrics:
            emitPodAnnotations: true
            emitNamespaceAnnotations: true

          kubecostModel:
            extraEnv:
              - name: LOG_LEVEL
                value: debug
          kubecostAggregator:
            extraEnv:
              - name: LOG_LEVEL
                value: debug

          oidc:
            enabled: true
            useIDToken: false
            clientID: "694442958934-3b6uv0ffu143f7vcmah0rlshbdh2rn1k.apps.googleusercontent.com"
            # clientSecret: ""
            secretName: "oidc-provider"
            authURL: "https://accounts.google.com/o/oauth2/v2/auth?response_type=code&client_id=694442958934-3b6uv0ffu143f7vcmah0rlshbdh2rn1k.apps.googleusercontent.com&scope=openid email&hd=astria.org&redirect_uri=https://kubecost.dev.astria.org/model/oidc/authorize&prompt=select_account"
            loginRedirectURL: "https://kubecost.dev.astria.org"
            discoveryURL: "https://accounts.google.com/.well-known/openid-configuration"
            hostedDomain: "astria.org"
            rbac:
              enabled: false


        # parameters:
        #   - name: oidc.clientSecret
        #     value: ""
        #   - name: oidc.secretName
        #     value: "oidc-client-secret"

        #   - name: ingress.enabled
        #     value: "true"
        #   - name: oidc.enabled
        #     value: "true" 
        #   - name: persistentVolume.enabled
        #     value: "true"


    - repoURL: https://github.com/astriaorg/astria.git
      ref: values
      targetRevision: argo-kubecost
  syncPolicy:
    automated: {}
